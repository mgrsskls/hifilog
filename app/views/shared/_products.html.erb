<% empty_state ||= "" %>
<% pull_out ||= defined?(pull_out) ? pull_out : true %>
<% include_images ||= defined?(include_images) ? include_images : true %>
<% include_image_upload ||= defined?(include_image_upload) ? include_image_upload : true %>
<% include_edit_link ||= false %>
<% include_delete_button ||= false %>
<% include_setup ||= false %>
<% hide_brand ||= false %>

<% if include_image_upload %>
  <% content_for :css do %>
    <%= stylesheet_link_tag "form" %>
  <% end %>
<% end %>

<div class="<%= "u-pullOut" if pull_out %> ProductListing">
  <% if items.any? %>
    <table>
      <thead>
        <tr>
          <% if include_images %>
            <th class="Table-image">Photo</th>
          <% end %>
          <th><%= t('name') %></th>
          <th><%= t('headings.category').html_safe %></th>
          <% if include_setup %>
            <th><%= t('headings.setup') %></th>
          <% end %>
          <% if include_edit_link || include_delete_button %>
            <th class="u-textEnd">Actions</th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% items.each do |item| %>
          <tr>
            <% if include_images %>
              <td class="Table-image">
                <% if include_image_upload %>
                  <%= render "shared/image_upload", item: item, prefix: "table" %>
                <% else %>
                  <%= render "shared/product_image_dialog", item: item, prefix: "table" %>
                <% end %>
              </td>
            <% end %>
            <th scope="row">
              <% unless hide_brand %>
                <%= item.product.present? ? item.brand_name : "<i>#{item.brand_name}</i>".html_safe %><br>
              <% end %>
              <b><%= item.show_path.present? ? (link_to "#{item.product.name if item.product_variant.present?} #{item.short_name}".strip, item.show_path) : item.name %></b>
            </th>
            <td class="Table-sm">
              <% if item.sub_categories.any? %>
                <%= item.sub_categories.map{ |sub_category| sub_category.name }.join(", ") %>
              <% else %>
                <%= item.categories.map{ |category| category.name }.join(", ") %>
              <% end %>
            </td>
            <% if include_setup %>
              <td class="Table-sm">
                <%= item.setup.present? ? item.setup.name : "-" %>
              </td>
            <% end %>
            <% if include_edit_link || include_delete_button %>
              <td class="Table-sm">
                <ul class="MetaLinks">
                  <% if include_edit_link %>
                    <li><%= link_to "Edit", item.edit_path %></li>
                  <% end %>
                  <% if include_delete_button %>
                    <li>
                      <%= button_to t('delete_custom_product.label'),
                        custom_product_path(id: item.custom_product.id),
                        method: :delete,
                        class: "DeleteButton",
                        "data-msg": t('delete_custom_product.confirm', name: item.name)
                      %>
                    </li>
                  <% end %>
                </ul>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
    <ol class="ProductList">
      <% items.each do |item| %>
        <li class="ProductList-item">
          <% if include_images %>
            <div class="u-flex u-gap-md">
              <div>
                <% if include_image_upload %>
                  <%= render "shared/image_upload", item: item, prefix: "list" %>
                <% else %>
                  <%= render "shared/product_image_dialog", item: item, prefix: "list" %>
                <% end %>
                 <% if include_setup && item.setup.present? %>
                  <small>
                    <i>
                      <%= item.setup.name if item.setup.present? %>
                    </i>
                  </small>
                <% end %>
              </div>
            <% end %>
              <div class="ProductList-content">
                <div class="ProductList-name">
                  <% unless hide_brand %>
                    <%= item.product.present? ? item.brand_name : "<i>#{item.brand_name}</i>".html_safe %><br>
                  <% end %>
                  <b><%= item.show_path.present? ? (link_to "#{item.product.name if item.product_variant.present?} #{item.short_name}".strip, item.show_path) : item.name %></b>
                </div>
                <p class="ProductList-categories">
                  <% if item.sub_categories.any? %>
                    <%= item.sub_categories.map{ |sub_category| sub_category.name }.join(", ") %>
                  <% else %>
                    <%= item.categories.map{ |category| category.name }.join(", ") %>
                  <% end %>
                </p>
                <% if include_edit_link || include_delete_button %>
                  <div class="ProductList-metaLinks">
                    <ul class="MetaLinks">
                      <% if include_edit_link %>
                        <li><%= link_to "Edit", item.edit_path %></li>
                      <% end %>
                      <% if include_delete_button %>
                        <li>
                          <%= button_to t('delete_custom_product.label'),
                            custom_product_path(id: item.custom_product.id),
                            method: :delete,
                            class: "DeleteButton",
                            "data-msg": t('delete_custom_product.confirm', name: item.name)
                          %>
                        </li>
                      <% end %>
                    </ul>
                  </div>
                <% end %>
              </div>
          <% if include_images %>
            </div>
          <% end %>
        </li>
      <% end %>
    </ol>
  <% else %>
    <%= render "shared/empty_state", message: empty_state %>
  <% end %>
</div>
