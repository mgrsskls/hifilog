<% hide_brand ||= false %>
<% hide_category ||= false %>

<div class="EntityList-name">
  <div class="u-flex u-gap-sm u-spaceBetween u-alignCenter">
    <div>
      <% unless hide_brand %>
        <span class="EntityList-brandName">
          <%= brand.name %>
        </span>
      <% end %>
      <a href="<%= path %>">
        <%= name %>
      </a>
      <% if model_no.present? || variant_name.present? %>
        <span class="EntityList-modelName">
          <%= variant_name if variant_name.present? %>
          <% if variant_name.present? && model_no.present? %>&middot;<% end %>
          <%= model_no if model_no.present? %>
        </span>
      <% end %>
    </div>
    <%= render "shared/symbols", item: product, type: item_type %>
  </div>
</div>

<% if diy_kit || @custom_attributes_for_products.any? %>
  <ul class="EntityList-tags">
    <% if diy_kit %>
      <li class="Tag">
        <%= t('activerecord.attributes.product.diy_kit') %>
      </li>
    <% end %>
    <% product.custom_attributes&.each do |custom_attribute| %>
      <% active_record = @custom_attributes_for_products.find { |ca| ca.label == custom_attribute[0] } %>
      <% if active_record&.highlighted? %>
        <% if active_record.inputs.size < 2 %>
          <% if active_record.input_type == 'boolean' %>
            <% if custom_attribute[1] %>
              <li class="Tag">
                <%= t("custom_attribute_labels.#{active_record.label}") %>
              </li>
            <% end %>
          <% elsif active_record.input_type == 'number' %>
            <li class="Tag">
              <% unit = t("custom_attribute_units.#{custom_attribute[1]['unit'].present? ? custom_attribute[1]['unit'] : active_record.units.first}") %>
              <%= custom_attribute[1]['value'] %> <%= unit.html_safe if unit.present? %>
            </li>
          <% elsif active_record.input_type == 'options' %>
            <% custom_attribute[1].each do |id| %>
              <li class="Tag">
                <%= t("custom_attributes.#{active_record.options[id]}") %>
              </li>
            <% end %>
          <% else %>
            <li class="Tag">
              <%= t("custom_attributes.#{active_record.options[custom_attribute[1].to_s]}") %>
            </li>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </ul>
<% end %>

<% if !hide_category || product.formatted_release_date.present? || product.formatted_discontinued_date.present? || product.price.present? %>
  <dl class="EntityList-data Data">
    <% unless hide_category %>
      <dt><%= Category.model_name.human %></dt>
      <dd><%= sub_category_names.join(", ") %></dd>
    <% end %>

    <% if product.formatted_release_date.present? || product.formatted_discontinued_date.present? %>
      <dt><%= t('activerecord.attributes.product.release_date') %></dt>
      <dd>
        <% if product.formatted_release_date.present? && product.formatted_discontinued_date.present? %>
          <%= sanitize(product.formatted_release_date) %> &ndash; <%= sanitize(product.formatted_discontinued_date) %>
        <% elsif product.formatted_discontinued_date.present? %>
          n/a &ndash; <%= sanitize(product.formatted_discontinued_date) %>
        <% elsif product.formatted_release_date.present? %>
          <%= sanitize(product.formatted_release_date) %>
        <% end %>
      </dd>
    <% end %>

    <% if product.price.present? %>
      <dt><%= t('activerecord.attributes.product.price') %></dt>
      <dd><%= display_price(product.price, product.price_currency) %></dd>
    <% end %>
  </dl>
<% end %>

<%= yield %>
