<% content_for :css do %>
  <%= stylesheet_link_tag "form" %>
  <%= stylesheet_link_tag "new_product" %>
<% end %>

<div class="Form Form--centered">
  <div class="Heading">
    <h1>
      <%= t('edit') %>
      <% if @brand %>
        <span><%= @product.name %></span>
      <% end %>
    </h1>
  </div>

  <details class="Instructions">
    <summary>
      Please read before editing a product
      <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 12"><path fill-rule="evenodd" d="M.5.72a1.49 1.49 0 0 1 2.1 0l7.39 7.39L17.38.72a1.49 1.49 0 1 1 2.1 2.1l-8.44 8.44a1.49 1.49 0 0 1-2.1 0L.5 2.82a1.49 1.49 0 0 1 0-2.1z" clip-rule="evenodd"/></svg>
    </summary>
    <div class="Instructions-content Rte">
      <p>Thank you for contributing to HiFi&thinsp;Log!</p>
      <p>Please read the following instructions to make sure all products are added properly:</p>
      <ul>
        <li>Please only add the product name, not the brand name, in the field "Name". The brand name will be added automatically.</li>
        <li>Not all information has to be filled out right away. Fields marked with "optional" can be filled out later.</li>
        <li>You can assign multiple categories to a product, for example "Over-Ear Headphones" + "Noise Cancelling Headphones".</li>
        <li>If you for example only know the year (or year and month) when a product has been released, you can omit the other fields.</li>
        <li>When adding a product to a brand that has been discontinued, the product will automatically be set to discontinued as well, no matter what you select.</li>
      </ul>
    </div>
  </details>

  <% if @product.errors.any? %>
    <%= render "shared/flash_messages", messages: @product.errors.map { |error| ["alert", error.full_message] } %>
  <% end %>

  <%= form_for @product, url: product_path(id: @product.id), html: { class: "NewProduct", method: :put } do |f| %>
    <div class="Form-field">
      <%= f.label :name, class: "Form-label" %>
      <%= f.text_field :name, required: true %>
    </div>

    <div class="Form-field">
      <div class="Form-label"><%= t('headings.categories') %></div>
      <div class="Options">
        <% @categories.each do |category| %>
          <details <% if (category.sub_category_ids & @product.sub_category_ids).any? %>open<% end %>>
          <summary><%= category.name %></summary>
            <% category.sub_categories.each do |sub_category| %>
              <div class="Options-item">
                <%= check_box_tag "product[sub_category_ids][#{sub_category.id}]", sub_category.id, @product.sub_category_ids.include?(sub_category.id), name: "product[sub_category_ids][]" %>
                <%= label_tag "product[sub_category_ids][#{sub_category.id}]", sub_category.name %>
              </div>
            <% end %>
          </details>
        <% end %>
      </div>
    </div>

    <div class="Form-field">
      <%= f.label :release_date, class: "Form-label" do %>
        Release date <small><i>(optional)</i></small>
      <% end %>
      <div class="NewProduct-date">
        <%= f.select :release_day do %>
          <option value="">Day</option>
          <% (1..31).each do |day| %>
            <option value="<%= day %>"<%= " selected" if @product.release_day == day %>><%= day %></option>
          <% end %>
        <% end %>
        <%= select_month(@product.release_month, field_name: "release_month", prefix: "product", prompt: "Month") %>
        <%= f.text_field :release_year, inputmode: "number", list: "years", placeholder: "Year" %>
      </div>
      <small>If you for example only know the year, you can also omit day and month.</small>
      <datalist id="years">
        <% (1900..Date.today.year+1).to_a.reverse.each do |year| %>
          <option value="<%= year %>"></option>
        <% end %>
      </datalist>
    </div>

    <div class="Form-field Form-field--inline">
      <span class="Form-label"><%= t('symbols.discontinued') %></span>
      <div class="Form-options">
        <%= f.radio_button :discontinued, 0, checked: (@product.discontinued.nil? || @product.discontinued == false) %>
        <%= f.label :discontinued, "No", value: 0 %>
        <%= f.radio_button :discontinued, 1, checked: (@product.discontinued == true) %>
        <%= f.label :discontinued, "Yes", value: 1  %>
      </div>
    </div>

    <div class="Form-submit">
      <%= f.button t('new_product.submit'), type: "submit", class: "Button" %>
    </div>
  <% end %>
</div>
